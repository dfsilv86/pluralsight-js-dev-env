<databaseChangeLog
		xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
		xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
		xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.0.xsd
		http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

	<changeSet id="log-relacao-item-loja-cd-fnItemAtendeRegrasVendorPrimario-Criacao" author="rafaelbueno">
		<sql stripComments="false" endDelimiter="~">
			<![CDATA[
				-- =============================================
				-- Author:		Rafael de Souza Bueno (CWI)
				-- Create date: 19/10/2016
				-- Description:	Valida as regras de itens tpVinculado = E no processo de vendor primário.
				-- =============================================
				CREATE FUNCTION [dbo].[fnItemAtendeRegrasVendorPrimario] (
					@blPossuiXRef BIT
					,@blStaple BIT
					,@blPrime BIT
					,@blPossuiSecundariosPrime BIT
					,@blCDConvertido BIT
					)
				RETURNS BIT
				AS
				BEGIN
					IF (
							@blPossuiXRef = 1
							AND @blStaple = 0
							AND @blPrime = 1
							AND @blPossuiSecundariosPrime = 1
							AND @blCDConvertido = 0
							)
						RETURN 0

					IF (
							@blPossuiXRef = 1
							AND @blStaple = 0
							AND @blPrime = 1
							AND @blPossuiSecundariosPrime = 0
							AND @blCDConvertido = 1
							)
						RETURN 0

					IF (
							@blPossuiXRef = 1
							AND @blStaple = 0
							AND @blPrime = 1
							AND @blPossuiSecundariosPrime = 0
							AND @blCDConvertido = 1
							)
						RETURN 0

					IF (
							@blPossuiXRef = 1
							AND @blStaple = 1
							AND @blPrime = 0
							AND @blPossuiSecundariosPrime = 1
							AND @blCDConvertido = 1
							)
						RETURN 0

					IF (
							@blPossuiXRef = 1
							AND @blStaple = 1
							AND @blPrime = 0
							AND @blPossuiSecundariosPrime = 0
							AND @blCDConvertido = 1
							)
						RETURN 0

					IF (
							@blPossuiXRef = 1
							AND @blStaple = 1
							AND @blPrime = 1
							AND @blPossuiSecundariosPrime = 0
							AND @blCDConvertido = 1
							)
						RETURN 0

					IF (
							@blPossuiXRef = 1
							AND @blStaple = 0
							AND @blPrime = 1
							AND @blPossuiSecundariosPrime = 1
							AND @blCDConvertido = 1
							)
						RETURN 0

					RETURN 1
				END

			]]>
		</sql>
		<rollback>
			<sql stripComments="false" endDelimiter="~">
				<![CDATA[ 
					DROP FUNCTION fnItemAtendeRegrasVendorPrimario
				]]>
			</sql>
		</rollback>		
	</changeSet>
</databaseChangeLog>
